<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Acompanhamento de Obras</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#0b1f13;
      --card:#0f2a1a;
      --line:#1f4d31;
      --text:#eafff1;
      --muted:#a6d7bb;
      --accent:#6fbf4a;
      --dark:#07140d;

      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
    }

    body{font-family:Arial, sans-serif;background:var(--bg);color:var(--text);margin:0;padding:14px}
    h1{margin:6px 0 10px;text-align:center;font-size:24px}
    .sub{max-width:980px;margin:0 auto 12px;text-align:center;color:var(--muted);font-size:13px}

    .toolbar{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;align-items:center;margin-bottom:12px}
    .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer}
    .btn-green{background:var(--accent);color:#07210f}
    .btn-gray{background:#1e3a2a;color:#fff}
    .btn-ghost{background:transparent;color:#fff;border:1px solid var(--line)}
    select{background:var(--dark);border:1px solid var(--line);color:#fff;border-radius:12px;padding:10px 12px;width:100%}

    .filters{max-width:980px;margin:0 auto 12px;display:none}
    .filters.on{display:block}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
    .label{color:var(--muted);font-size:12px;margin-bottom:6px}

    .card{max-width:980px;margin:0 auto 12px;background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:space-between}
    .meta{color:var(--muted);font-size:13px;line-height:1.35}
    .title{font-size:16px;font-weight:900;margin-top:6px}

    .kvs{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .kv{background:rgba(255,255,255,.03);border:1px solid var(--line);border-radius:12px;padding:8px 10px}
    .kv b{display:block;font-size:12px;color:var(--muted);margin-bottom:2px}
    .kv span{font-weight:900}

    .moreCols{display:none}
    .moreOn .moreCols{display:flex}

    .empty{max-width:980px;margin:20px auto;text-align:center;color:var(--muted)}
    .error{max-width:980px;margin:0 auto 12px;background:#7f1d1d;border:1px solid #ef4444;color:#fff;padding:10px;border-radius:12px;display:none;white-space:pre-wrap}
    .footer{max-width:980px;margin:22px auto 8px;text-align:center;color:var(--muted);font-size:12px}

    /* CALENDÁRIO VISUAL */
    .calWrap{max-width:980px;margin:0 auto 12px}
    .calCard{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:12px}
    .calHead{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .calTitle{font-weight:900}
    .calBtns{display:flex;gap:10px}
    .calGrid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;margin-top:12px}
    .calDow{color:var(--muted);font-size:12px;text-align:center}
    .day{
      text-align:center;
      padding:10px 0;
      border-radius:12px;
      border:1px solid transparent;
      background:rgba(255,255,255,.03);
      cursor:pointer;
      user-select:none;
    }
    .day.muted{opacity:.35;cursor:default}
    .day.today{border-color:rgba(111,191,74,.5)}
    .day.sel{background:rgba(111,191,74,.35);border-color:var(--accent)}
    .day:hover{border-color:rgba(111,191,74,.35)}
    .calInfo{margin-top:10px;color:var(--muted);font-size:13px}

    /* Modal */
    .modalBack{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:14px;z-index:9999}
    .modalBack.on{display:flex}
    .modal{width:min(900px,100%);background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}
    .modalHead{display:flex;gap:10px;justify-content:space-between;align-items:flex-start}
    .modalTitle{font-weight:900;font-size:18px;margin:0}
    input, textarea{
      width:100%;
      background:var(--dark);
      border:1px solid var(--line);
      color:#fff;
      border-radius:12px;
      padding:10px 12px;
      font-size:16px;
    }
    textarea{min-height:84px;resize:vertical}

    .noteItem{background:var(--dark);border:1px solid var(--line);border-radius:12px;padding:10px;margin-top:10px}
    .noteTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px}
    .noteText{margin-top:8px;white-space:pre-wrap;line-height:1.35}

    .badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;
      font-weight:900;font-size:12px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);
    }
    .b-ok{border-color:rgba(34,197,94,.55); background:rgba(34,197,94,.12)}
    .b-warn{border-color:rgba(245,158,11,.55); background:rgba(245,158,11,.12)}
    .b-bad{border-color:rgba(239,68,68,.55); background:rgba(239,68,68,.12)}

    @media (max-width:920px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (max-width:560px){
      body{padding:12px}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <h1>Acompanhamento de Obras</h1>
  <div class="sub" id="subtitle">Carregando...</div>

  <!-- CALENDÁRIO VISUAL -->
  <div class="calWrap">
    <div class="calCard">
      <div class="calHead">
        <div>
          <div class="calTitle" id="calTitle">Calendário</div>
          <div class="calInfo" id="calInfo">Selecionado: -</div>
        </div>
        <div class="calBtns">
          <button class="btn btn-ghost" id="prevMonth">◀</button>
          <button class="btn btn-ghost" id="todayBtn">Hoje</button>
          <button class="btn btn-ghost" id="nextMonth">▶</button>
        </div>
      </div>

      <div class="calGrid" id="calDow"></div>
      <div class="calGrid" id="calDays"></div>
    </div>
  </div>

  <div class="toolbar">
    <button class="btn btn-gray" id="toggleFilters">Mostrar filtros</button>
    <button class="btn btn-ghost" id="clearFilters">Limpar filtros</button>
    <button class="btn btn-gray" id="toggleCols">Mostrar mais colunas</button>
    <button class="btn btn-green" id="reload">Recarregar</button>
  </div>

  <div id="err" class="error"></div>

  <div id="filters" class="filters">
    <div class="card">
      <div class="row">
        <div class="meta"><b>Filtros</b> (selecionou → atualiza)</div>
      </div>

      <div style="height:12px"></div>

      <div class="grid">
        <div>
          <div class="label">CRITÉRIO</div>
          <select id="fCriterio"></select>
        </div>
        <div>
          <div class="label">MUNICÍPIO</div>
          <select id="fMunicipio"></select>
        </div>
        <div>
          <div class="label">AGENTE RESPONSÁVEL (AR)</div>
          <select id="fAR"></select>
        </div>
        <div>
          <div class="label">UNIDADE</div>
          <select id="fUnidade"></select>
        </div>
      </div>
    </div>
  </div>

  <div id="lista"></div>
  <div class="footer">UTEP Nordeste • Supabase • Calendário + Filtros + Notas</div>

  <!-- MODAL NOTAS -->
  <div id="modalBack" class="modalBack">
    <div class="modal">
      <div class="modalHead">
        <div>
          <p class="modalTitle" id="modalTitle">Notas</p>
          <div class="meta" id="modalMeta"></div>
        </div>
        <button class="btn btn-gray" id="closeModal">Fechar</button>
      </div>

      <div style="height:10px"></div>

      <div class="grid" style="grid-template-columns:1fr 1fr 2fr;gap:10px">
        <div>
          <div class="label">Seu nome</div>
          <input id="noteAuthor" placeholder="Ex.: João Silva"/>
        </div>
        <div>
          <div class="label">Status da execução</div>
          <select id="noteStatus">
            <option value="Executada">✅ Executada</option>
            <option value="Houve problemas">⚠️ Houve problemas</option>
            <option value="Não foi executada">❌ Não foi executada</option>
          </select>
        </div>
        <div>
          <div class="label">Adicionar nota</div>
          <textarea id="noteText" placeholder="Escreva a observação desta obra..."></textarea>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:10px">
        <button class="btn btn-green" id="saveNote">Salvar nota</button>
      </div>

      <div style="height:10px"></div>
      <div id="notesList"></div>
    </div>
  </div>

<script>
/* ====== CONFIG SUPABASE ====== */
const SUPABASE_URL = "https://yyfhnuafwzeglwcpnmkd.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_7rmfNL9N6limSSFxFcl2Og_MV9xkbjx";
const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ====== UTIL ====== */
const $ = (id)=>document.getElementById(id);

function showErr(msg){
  const el = $("err");
  el.style.display="block";
  el.textContent=String(msg);
}
function clearErr(){
  const el = $("err");
  el.style.display="none";
  el.textContent="";
}
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;");
}
function pick(obj, keys){
  for(const k of keys){
    if(obj && obj[k] !== undefined && obj[k] !== null && String(obj[k]).trim() !== "") return obj[k];
  }
  return "";
}
function parseAnyDate(v){
  if(!v) return null;
  const s = String(v).trim();
  if(!s) return null;

  const m = s.match(/^(\d{2})\/(\d{2})\/(\d{4})$/);
  if(m){
    const [_, dd, mm, yyyy] = m;
    return new Date(Number(yyyy), Number(mm)-1, Number(dd));
  }
  const m2 = s.match(/^(\d{4})-(\d{2})-(\d{2})/);
  if(m2){
    const [_, yyyy, mm, dd] = m2;
    return new Date(Number(yyyy), Number(mm)-1, Number(dd));
  }
  const d = new Date(s);
  return isNaN(d.getTime()) ? null : d;
}
function startOfDay(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
function addDays(d, n){ const x = new Date(d); x.setDate(x.getDate()+n); return x; }
function sameDay(a,b){
  return a && b &&
    a.getFullYear()===b.getFullYear() &&
    a.getMonth()===b.getMonth() &&
    a.getDate()===b.getDate();
}
function fmtBR(d){
  if(!d) return "-";
  const dd = String(d.getDate()).padStart(2,"0");
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const yyyy = d.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

/* ====== STATUS EMBUTIDO NO TEXTO ====== */
function packStatus(status, texto){
  return `[[STATUS:${status}]]\n${texto}`;
}
function unpackStatus(texto){
  const s = String(texto ?? "");
  const m = s.match(/^\s*\[\[STATUS:(.+?)\]\]\s*\n?/);
  if(m){
    return { status: m[1].trim(), texto: s.replace(m[0], "").trim() };
  }
  return { status: "", texto: s };
}
function statusBadge(status){
  const st = (status||"").toLowerCase();
  if(st.includes("executada")) return `<span class="badge b-ok">✅ Executada</span>`;
  if(st.includes("problema")) return `<span class="badge b-warn">⚠️ Houve problemas</span>`;
  if(st.includes("não") || st.includes("nao")) return `<span class="badge b-bad">❌ Não foi executada</span>`;
  return `<span class="badge">ℹ️ Sem status</span>`;
}

/* ====== STATE ====== */
let ALL = [];
let FILTERS = { criterio:"", municipio:"", ar:"", unidade:"" };
let selectedDate = startOfDay(new Date());
let viewMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);

let showMoreCols = false;

let currentNota = null;
let currentMeta = null;

/* ====== CALENDÁRIO ====== */
const DOW = ["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"];

function renderCalendar(){
  $("calTitle").textContent = viewMonth.toLocaleDateString("pt-BR", { month:"long", year:"numeric" })
    .replace(/^./, c=>c.toUpperCase());
  $("calInfo").textContent = `Selecionado: ${fmtBR(selectedDate)}`;

  $("calDow").innerHTML = DOW.map(d=>`<div class="calDow">${d}</div>`).join("");

  const firstDay = new Date(viewMonth.getFullYear(), viewMonth.getMonth(), 1);
  const startIdx = firstDay.getDay();
  const start = new Date(firstDay);
  start.setDate(start.getDate() - startIdx);

  const days = [];
  for(let i=0;i<42;i++){
    const d = new Date(start);
    d.setDate(start.getDate()+i);

    const inMonth = d.getMonth() === viewMonth.getMonth();
    const isToday = sameDay(d, startOfDay(new Date()));
    const isSel = sameDay(d, selectedDate);

    days.push({ date:d, label:d.getDate(), inMonth, isToday, isSel });
  }

  $("calDays").innerHTML = days.map(x=>{
    const cls = [
      "day",
      x.inMonth ? "" : "muted",
      x.isToday ? "today" : "",
      x.isSel ? "sel" : ""
    ].filter(Boolean).join(" ");

    const click = x.inMonth ? `onclick="selectDay('${x.date.toISOString()}')"` : "";
    return `<div class="${cls}" ${click}>${x.label}</div>`;
  }).join("");
}

function selectDay(iso){
  const d = new Date(iso);
  selectedDate = startOfDay(d);
  renderCalendar();
  render();
}
window.selectDay = selectDay;

/* ====== OBRAS ====== */
async function fetchObras(){
  clearErr();
  $("subtitle").textContent = "Carregando obras...";
  $("lista").innerHTML = `<div class="empty">Carregando...</div>`;

  const { data, error } = await sb.from("obras").select("*").limit(5000);
  if(error){
    showErr("Erro ao carregar obras:\n" + JSON.stringify(error, null, 2));
    $("lista").innerHTML = "";
    $("subtitle").textContent = "Erro ao carregar.";
    return;
  }

  ALL = data || [];
  buildFilterOptions();
  render();
}

function normalizeObra(o){
  const nota = pick(o, ["nota","NOTA"]);
  const projeto = pick(o, ["projeto","PROJETO"]);
  const titulo = pick(o, ["titulo","TITULO"]);
  const criterio = pick(o, ["criterio","CRITERIO","criterio_","CRITERIO_"]);
  const municipio = pick(o, ["municipio","MUNICIPIO"]);
  const ar = pick(o, ["agente_responsavel","AGENTE_RESPONSAVEL"]);
  const unidade = pick(o, ["unidade","UNIDADE"]);
  const localidade = pick(o, ["localidade","LOCALIDADE"]);
  const gerencia = pick(o, ["gerencia","GERENCIA"]);

  const fimRaw = pick(o, ["previsao_execucao_fim","PREVISAO_EXECUCAO_FIM"]);
  const dtFim = parseAnyDate(fimRaw);

  return { raw:o, nota, projeto, titulo, criterio, municipio, ar, unidade, localidade, gerencia, dtFim };
}

function uniqSorted(arr){
  return Array.from(new Set(arr.filter(Boolean).map(x=>String(x).trim())))
    .sort((a,b)=>a.localeCompare(b,"pt-BR"));
}
function fillSelect(sel, values, allLabel){
  const cur = sel.value;
  sel.innerHTML = "";
  values.forEach(v=>{
    const opt = document.createElement("option");
    opt.value = v;
    opt.textContent = v ? v : allLabel;
    sel.appendChild(opt);
  });
  if(values.includes(cur)) sel.value = cur;
}
function buildFilterOptions(){
  const norm = ALL.map(normalizeObra);
  fillSelect($("fCriterio"), ["", ...uniqSorted(norm.map(x=>x.criterio))], "Todos");
  fillSelect($("fMunicipio"), ["", ...uniqSorted(norm.map(x=>x.municipio))], "Todos");
  fillSelect($("fAR"), ["", ...uniqSorted(norm.map(x=>x.ar))], "Todos");
  fillSelect($("fUnidade"), ["", ...uniqSorted(norm.map(x=>x.unidade))], "Todos");
}
function applyFilters(list){
  return list.filter(x=>{
    if(FILTERS.criterio && String(x.criterio) !== FILTERS.criterio) return false;
    if(FILTERS.municipio && String(x.municipio) !== FILTERS.municipio) return false;
    if(FILTERS.ar && String(x.ar) !== FILTERS.ar) return false;
    if(FILTERS.unidade && String(x.unidade) !== FILTERS.unidade) return false;
    return true;
  });
}

/* ====== RENDER: DIA SELECIONADO OU PRÓXIMOS 5 DIAS ====== */
function render(){
  const base = startOfDay(selectedDate);
  const end5 = startOfDay(addDays(base, 5));

  const norm = applyFilters(ALL.map(normalizeObra)).filter(x=>x.dtFim);

  const doDia = norm
    .filter(x => sameDay(startOfDay(x.dtFim), base))
    .sort((a,b)=>a.dtFim - b.dtFim);

  let list = doDia;
  let header = `Obras com prazo final em <b>${fmtBR(base)}</b>`;

  if(list.length === 0){
    const proximas = norm
      .filter(x => {
        const d = startOfDay(x.dtFim);
        return d >= base && d <= end5;
      })
      .sort((a,b)=>a.dtFim - b.dtFim);

    list = proximas;
    header = `Nenhuma obra vence em <b>${fmtBR(base)}</b>. Mostrando as que vencem nos <b>próximos 5 dias</b> (até ${fmtBR(end5)})`;
  }

  $("subtitle").innerHTML = header;

  if(list.length === 0){
    $("lista").innerHTML = `<div class="empty">Sem obras para mostrar com os filtros atuais.</div>`;
    return;
  }

  const moreClass = showMoreCols ? "moreOn" : "";

  $("lista").innerHTML = list.map(x=>{
    const prazo = x.dtFim ? fmtBR(x.dtFim) : "-";

    return `
      <div class="card ${moreClass}">
        <div class="row">
          <div>
            <div class="title">${escapeHtml(x.titulo || "(Sem título)")}</div>
            <div class="meta">${escapeHtml(x.criterio || "")} • ${escapeHtml(x.municipio || "")}</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end">
            <button class="btn btn-gray" onclick="openNotes('${escapeHtml(String(x.nota))}')">Notas</button>
          </div>
        </div>

        <!-- FIXAS -->
        <div class="kvs">
          <div class="kv"><b>NOTA</b><span>${escapeHtml(x.nota || "-")}</span></div>
          <div class="kv"><b>PROJETO</b><span>${escapeHtml(x.projeto || "-")}</span></div>
          <div class="kv"><b>PRAZO FINAL</b><span>${escapeHtml(prazo)}</span></div>
          <div class="kv"><b>AR</b><span>${escapeHtml(x.ar || "-")}</span></div>
          <div class="kv"><b>UNIDADE</b><span>${escapeHtml(x.unidade || "-")}</span></div>
        </div>

        <!-- OPCIONAIS -->
        <div class="kvs moreCols">
          <div class="kv"><b>LOCALIDADE</b><span>${escapeHtml(x.localidade || "-")}</span></div>
          <div class="kv"><b>GERÊNCIA</b><span>${escapeHtml(x.gerencia || "-")}</span></div>
        </div>
      </div>
    `;
  }).join("");
}

/* ====== NOTAS (MODAL) ====== */
async function openNotes(nota){
  currentNota = String(nota);

  $("modalBack").classList.add("on");
  $("notesList").innerHTML = `<div class="meta">Carregando notas...</div>`;
  $("noteText").value = "";

  const found = ALL.map(normalizeObra).find(x=>String(x.nota) === currentNota);
  currentMeta = found || null;

  $("modalTitle").textContent = `Notas - Nota ${currentNota}`;
  $("modalMeta").innerHTML = currentMeta
    ? `${escapeHtml(currentMeta.titulo || "")} • ${escapeHtml(currentMeta.municipio || "")} • ${escapeHtml(currentMeta.criterio || "")}`
    : "";

  await loadNotes();
}
function closeNotes(){
  $("modalBack").classList.remove("on");
  currentNota = null;
  currentMeta = null;
}

async function loadNotes(){
  if(!currentNota) return;

  const { data, error } = await sb
    .from("notes")
    .select("id,nota,autor,texto,created_at")
    .eq("nota", currentNota)
    .order("created_at", { ascending:false });

  if(error){
    $("notesList").innerHTML = `<div class="meta">Erro ao carregar notas:<br>${escapeHtml(JSON.stringify(error))}</div>`;
    return;
  }

  if(!data || data.length === 0){
    $("notesList").innerHTML = `<div class="meta">Sem notas ainda.</div>`;
    return;
  }

  $("notesList").innerHTML = data.map(n=>{
    const dt = n.created_at ? new Date(n.created_at).toLocaleString("pt-BR") : "-";
    const parsed = unpackStatus(n.texto);
    return `
      <div class="noteItem">
        <div class="noteTop">
          <div><b>${escapeHtml(n.autor || "(sem autor)")}</b></div>
          <div>${escapeHtml(dt)}</div>
        </div>
        <div style="margin-top:8px">${statusBadge(parsed.status)}</div>
        <div class="noteText">${escapeHtml(parsed.texto || "")}</div>
      </div>
    `;
  }).join("");
}

async function saveNote(){
  if(!currentNota) return;

  const autor = $("noteAuthor").value.trim();
  const texto = $("noteText").value.trim();
  const status = $("noteStatus").value;

  if(!autor || !texto){
    showErr("Preencha seu nome e a anotação antes de salvar.");
    return;
  }
  clearErr();

  const textoFinal = packStatus(status, texto);

  const { error } = await sb.from("notes").insert({
    nota: currentNota,
    autor,
    texto: textoFinal
  });

  if(error){
    showErr("Erro ao salvar nota:\n" + JSON.stringify(error, null, 2));
    return;
  }

  $("noteText").value = "";
  await loadNotes();
}

/* ====== EVENTOS ====== */
$("reload").addEventListener("click", fetchObras);

$("toggleFilters").addEventListener("click", ()=>{
  const box = $("filters");
  box.classList.toggle("on");
  $("toggleFilters").textContent = box.classList.contains("on") ? "Ocultar filtros" : "Mostrar filtros";
});

$("clearFilters").addEventListener("click", ()=>{
  FILTERS = { criterio:"", municipio:"", ar:"", unidade:"" };
  $("fCriterio").value = "";
  $("fMunicipio").value = "";
  $("fAR").value = "";
  $("fUnidade").value = "";
  render();
});

$("toggleCols").addEventListener("click", ()=>{
  showMoreCols = !showMoreCols;
  $("toggleCols").textContent = showMoreCols ? "Ocultar colunas extras" : "Mostrar mais colunas";
  render();
});

$("fCriterio").addEventListener("change", (e)=>{ FILTERS.criterio = e.target.value; render(); });
$("fMunicipio").addEventListener("change", (e)=>{ FILTERS.municipio = e.target.value; render(); });
$("fAR").addEventListener("change", (e)=>{ FILTERS.ar = e.target.value; render(); });
$("fUnidade").addEventListener("change", (e)=>{ FILTERS.unidade = e.target.value; render(); });

$("closeModal").addEventListener("click", closeNotes);
$("modalBack").addEventListener("click", (e)=>{ if(e.target.id==="modalBack") closeNotes(); });
$("saveNote").addEventListener("click", saveNote);

$("prevMonth").addEventListener("click", ()=>{
  viewMonth = new Date(viewMonth.getFullYear(), viewMonth.getMonth()-1, 1);
  renderCalendar();
});
$("nextMonth").addEventListener("click", ()=>{
  viewMonth = new Date(viewMonth.getFullYear(), viewMonth.getMonth()+1, 1);
  renderCalendar();
});
$("todayBtn").addEventListener("click", ()=>{
  selectedDate = startOfDay(new Date());
  viewMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
  renderCalendar();
  render();
});

window.openNotes = openNotes;

(function init(){
  renderCalendar();
  fetchObras();
})();
</script>

</body>
</html>
